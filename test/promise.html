<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html">
  <meta http-equiv="X-UA-Compatible" content="IE=9">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>test: when</title>
  <script src="../src/script.js"></script>
</head>

<body>
  <h1>
    <pre id="pre"></pre>
  </h1>
  <script>
    var pre = document.getElementById('pre');

    new script.promise(function (resolve) {
      pre.innerHTML += "<h3>Waterfall</h3>";
      setTimeout(function () {
        pre.innerHTML += "[1] First task (async)<br>";
        resolve(10);
      }, 1000);
    })
      .then(function (result) {
        pre.innerHTML += "[2] Got:" + result + "<br>";
        return new script.promise(function (resolve) {
          setTimeout(function () {
            pre.innerHTML += "[2.1] Second task (async)<br>";
            resolve(result * 2);
          }, 500);
        });
      })
      .then(function (result) {
        pre.innerHTML += "[3] Got:" + result + "<br>";
        return result + 5;
      })
      .then(function (result) {
        pre.innerHTML += "[4] Final result:" + result + "<br>";
      })
      .catch(function (error) {
        pre.innerHTML += "Waterfall failed:" + error + "<br>";
      });

    script.promise.delay(2000)
      .then(function () {
        pre.innerHTML += "<h3>Delay</h3>";
      })
      .then(function () {
        pre.innerHTML += "Delay After 2 second<br>"
      })
      .then(function() {
        pre.innerHTML += "Next after delay<br>"
      })
      .catch(function (error) {
        pre.innerHTML += "Delay failed:" + error + "<br>";
      });
  </script>
</body>

</html>